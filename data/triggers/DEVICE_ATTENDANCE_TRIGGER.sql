create or replace TRIGGER DEVICE_ATTENDANCE_TRIGGER AFTER
  INSERT ON HRIS_ATTENDANCE FOR EACH ROW DECLARE V_ATTENDANCE_TIME HRIS_ATTENDANCE.ATTENDANCE_TIME%TYPE := NULL;
  V_DIFF_IN_MIN NUMBER;
  BEGIN
    BEGIN
      SELECT IN_TIME
      INTO V_ATTENDANCE_TIME
      FROM HRIS_ATTENDANCE_DETAIL
      WHERE ATTENDANCE_DT = TO_DATE (:new.ATTENDANCE_DT, 'DD-MON-YY')
      AND EMPLOYEE_ID     = :new.EMPLOYEE_ID;
    EXCEPTION
    WHEN NO_DATA_FOUND THEN
      DBMS_OUTPUT.PUT_LINE ('Attendance Job for '||:new.ATTENDANCE_DT||' not excecuted');
    END;
    IF (V_ATTENDANCE_TIME IS NULL) THEN
      UPDATE HRIS_ATTENDANCE_DETAIL
      SET IN_TIME         = :new.ATTENDANCE_TIME,
        IN_REMARKS = :new.REMARKS
      WHERE ATTENDANCE_DT = :new.ATTENDANCE_DT
      AND EMPLOYEE_ID     = :new.EMPLOYEE_ID;
    ELSE
      SELECT SUM(ABS(EXTRACT( HOUR FROM DIFF ))*60 + ABS(EXTRACT( MINUTE FROM DIFF )))
      INTO V_DIFF_IN_MIN
      FROM
        (SELECT :new.ATTENDANCE_TIME -V_ATTENDANCE_TIME AS DIFF FROM DUAL
        ) ;
      UPDATE HRIS_ATTENDANCE_DETAIL
      SET OUT_TIME        = :new.ATTENDANCE_TIME,
        TOTAL_HOUR        = V_DIFF_IN_MIN,
        OUT_REMARKS = :new.REMARKS
      WHERE ATTENDANCE_DT = :new.ATTENDANCE_DT
      AND EMPLOYEE_ID     = :new.EMPLOYEE_ID;
    END IF;
  END;