CREATE OR REPLACE TRIGGER UPDATE_EMPLOYEE_SERVICE AFTER
  INSERT OR
  UPDATE ON HRIS_JOB_HISTORY FOR EACH ROW DECLARE IS_LATEST NUMBER:=0;
  BEGIN
    SELECT COUNT(*)
    INTO IS_LATEST
    FROM
      (SELECT MAX(START_DATE) AS MAX_START_DATE
      FROM HRIS_JOB_HISTORY
      WHERE EMPLOYEE_ID=700055
      GROUP BY EMPLOYEE_ID
      ) H
    WHERE H.MAX_START_DATE=:new.START_DATE ;
    IF (IS_LATEST         >0) THEN
      UPDATE HRIS_EMPLOYEES
      SET BRANCH_ID          =:new.TO_BRANCH_ID,
        DEPARTMENT_ID        =:new.TO_DEPARTMENT_ID,
        DESIGNATION_ID       =:new.TO_DESIGNATION_ID,
        POSITION_ID          =:new.TO_POSITION_ID,
        SERVICE_TYPE_ID      =:new.TO_SERVICE_TYPE_ID,
        SERVICE_EVENT_TYPE_ID=:new.SERVICE_EVENT_TYPE_ID,
        COMPANY_ID           =:new.TO_COMPANY_ID
      WHERE EMPLOYEE_ID      =:new.EMPLOYEE_ID;
    END IF;
    IF (:new.SERVICE_EVENT_TYPE_ID=2) THEN
      UPDATE HRIS_EMPLOYEES
      SET APP_BRANCH_ID          =:new.TO_BRANCH_ID,
        APP_DEPARTMENT_ID        =:new.TO_DEPARTMENT_ID,
        APP_DESIGNATION_ID       =:new.TO_DESIGNATION_ID,
        APP_POSITION_ID          =:new.TO_POSITION_ID,
        APP_SERVICE_TYPE_ID      =:new.TO_SERVICE_TYPE_ID,
        APP_SERVICE_EVENT_TYPE_ID=:new.SERVICE_EVENT_TYPE_ID,
        RETIRED_FLAG             ='N'
      WHERE EMPLOYEE_ID          =:new.EMPLOYEE_ID;
    END IF;
    IF (:new.SERVICE_EVENT_TYPE_ID=1 OR :new.SERVICE_EVENT_TYPE_ID=3 OR :new.SERVICE_EVENT_TYPE_ID=4) THEN
      UPDATE HRIS_EMPLOYEES SET RETIRED_FLAG='N' WHERE EMPLOYEE_ID=:new.EMPLOYEE_ID;
    END IF;
    IF (:new.SERVICE_EVENT_TYPE_ID=5 OR :new.SERVICE_EVENT_TYPE_ID=8 OR :new.SERVICE_EVENT_TYPE_ID=14) THEN
      UPDATE HRIS_EMPLOYEES SET RETIRED_FLAG='Y' WHERE EMPLOYEE_ID=:new.EMPLOYEE_ID;
    END IF;
  END;