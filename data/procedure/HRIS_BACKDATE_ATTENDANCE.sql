CREATE OR REPLACE PROCEDURE HRIS_BACKDATE_ATTENDANCE(
    P_ID HRIS_ATTENDANCE_REQUEST.ID%TYPE )
AS
  P_ATTENDANCE_DT HRIS_ATTENDANCE_REQUEST.ATTENDANCE_DT%TYPE;
  P_EMPLOYEE_ID HRIS_EMPLOYEES.EMPLOYEE_ID%TYPE;
  P_IN_TIME HRIS_ATTENDANCE_REQUEST.IN_TIME%TYPE;
  P_OUT_TIME HRIS_ATTENDANCE_REQUEST.OUT_TIME%TYPE;
  P_STATUS HRIS_ATTENDANCE_REQUEST.STATUS%TYPE;
BEGIN
  SELECT ATTENDANCE_DT,
    EMPLOYEE_ID,
    IN_TIME,
    OUT_TIME,
    STATUS
  INTO P_ATTENDANCE_DT,
    P_EMPLOYEE_ID,
    P_IN_TIME,
    P_OUT_TIME,
    P_STATUS
  FROM HRIS_ATTENDANCE_REQUEST
  WHERE ID     =P_ID;
  IF P_STATUS != 'AP' THEN
    RETURN;
  END IF;
  IF P_IN_TIME IS NOT NULL THEN
    INSERT
    INTO HRIS_ATTENDANCE
      (
        ATTENDANCE_DT,
        EMPLOYEE_ID,
        ATTENDANCE_TIME,
        ATTENDANCE_FROM
      )
      VALUES
      (
        P_ATTENDANCE_DT,
        P_EMPLOYEE_ID,
       TO_DATE(TO_CHAR(P_ATTENDANCE_DT,'DD-MON-YYYY')||' '||TO_CHAR(P_IN_TIME,'HH:MI AM'),'DD-MON-YYYY HH:MI AM'),
        'SYSTEM'
      );
    HRIS_ATTENDANCE_AFTER_INSERT(P_EMPLOYEE_ID,P_ATTENDANCE_DT,P_IN_TIME,'SYSTEM');
  END IF;
  IF P_OUT_TIME IS NOT NULL THEN
    INSERT
    INTO HRIS_ATTENDANCE
      (
        ATTENDANCE_DT,
        EMPLOYEE_ID,
        ATTENDANCE_TIME,
        ATTENDANCE_FROM
      )
      VALUES
      (
        P_ATTENDANCE_DT,
        P_EMPLOYEE_ID,
        TO_DATE(TO_CHAR(P_ATTENDANCE_DT,'DD-MON-YYYY')||' '||TO_CHAR(P_OUT_TIME,'HH:MI AM'),'DD-MON-YYYY HH:MI AM'),
        'SYSTEM'
      );
    HRIS_ATTENDANCE_AFTER_INSERT(P_EMPLOYEE_ID,P_ATTENDANCE_DT,P_OUT_TIME,'SYSTEM');
  END IF;
  IF(TRUNC(P_ATTENDANCE_DT)<TRUNC(SYSDATE)) THEN
    HRIS_QUEUE_REATTENDANCE(TRUNC(P_ATTENDANCE_DT),P_EMPLOYEE_ID,TRUNC(P_ATTENDANCE_DT));
  END IF;
EXCEPTION
WHEN NO_DATA_FOUND THEN
  NULL;
END;