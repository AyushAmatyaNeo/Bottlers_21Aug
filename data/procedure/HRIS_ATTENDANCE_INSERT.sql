CREATE OR REPLACE PROCEDURE HRIS_ATTENDANCE_INSERT(
    P_THUMB_ID        NUMBER,
    P_ATTENDANCE_DT   DATE,
    P_IP_ADDRESS      VARCHAR2,
    P_ATTENDANCE_FROM VARCHAR2,
    P_ATTENDANCE_TIME TIMESTAMP,
    P_REMARKS         VARCHAR2:=NULL)
AS
  V_EMPLOYEE_ID NUMBER;
BEGIN
  BEGIN
    SELECT EMPLOYEE_ID
    INTO V_EMPLOYEE_ID
    FROM HRIS_EMPLOYEES
    WHERE ID_THUMB_ID=P_THUMB_ID;
  EXCEPTION
  WHEN NO_DATA_FOUND THEN
    INSERT
    INTO HRIS_ATTENDANCE_DATA_LOG
      (
        THUMB_ID,
        STATUS,
        CREATED_DATE
      )
      VALUES
      (
        P_THUMB_ID,
        'NO EMPLOYEE ASSIGNED FOR THIS THUMB_ID : '
        ||P_THUMB_ID,
        SYSDATE
      );
  WHEN too_many_rows THEN
    INSERT
    INTO HRIS_ATTENDANCE_DATA_LOG
      (
        THUMB_ID,
        STATUS,
        CREATED_DATE
      )
      VALUES
      (
        P_THUMB_ID,
        'MULTIPLE EMPLOYEE ASSIGNED FOR THIS THUMB_ID : '
        ||P_THUMB_ID,
        SYSDATE
      );
  END;
  INSERT
  INTO HRIS_ATTENDANCE
    (
      EMPLOYEE_ID,
      ATTENDANCE_DT,
      IP_ADDRESS,
      ATTENDANCE_FROM,
      ATTENDANCE_TIME,
      THUMB_ID
    )
    VALUES
    (
      V_EMPLOYEE_ID ,
      P_ATTENDANCE_DT,
      P_IP_ADDRESS,
      P_ATTENDANCE_FROM,
      P_ATTENDANCE_TIME,
      P_THUMB_ID
    );
  BEGIN
    HRIS_ATTENDANCE_AFTER_INSERT(V_EMPLOYEE_ID,P_ATTENDANCE_DT,P_ATTENDANCE_TIME,P_REMARKS);
  END;
END;