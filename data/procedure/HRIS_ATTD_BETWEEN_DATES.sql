create or replace PROCEDURE HRIS_ATTD_BETWEEN_DATES (
V_CONTRACT_ID NUMBER
) AS
V_WORKING_CYCLE CHAR(1 BYTE);
V_FROM_DATE DATE;
V_TO_DATE DATE;
V_DATE_DIFF NUMBER;
V_TEMP_DAY NUMBER;
V_TEMP_COUNT NUMBER;
V_TEMP_EMP_ID NUMBER;
BEGIN

DELETE FROM HRIS_CUST_CONTRACT_ATTENDANCE WHERE CONTRACT_ID=V_CONTRACT_ID;


SELECT START_DATE,END_DATE,WORKING_CYCLE INTO V_FROM_DATE,V_TO_DATE,V_WORKING_CYCLE
FROM HRIS_CUSTOMER_CONTRACT WHERE CONTRACT_ID=V_CONTRACT_ID;

if V_WORKING_CYCLE = 'W' then
BEGIN
SELECT V_TO_DATE -  V_FROM_DATE INTO V_DATE_DIFF FROM   dual;

  BEGIN
  FOR i IN 0..V_DATE_DIFF
  LOOP 
  SELECT TO_CHAR(V_FROM_DATE+i,'D') INTO V_TEMP_DAY FROM DUAL;
   DBMS_OUTPUT.PUT_LINE(V_FROM_DATE+i);
   DBMS_OUTPUT.PUT_LINE('DAY NO IS '||V_TEMP_DAY);

   SELECT  count(*) into V_TEMP_COUNT FROM HRIS_CUST_CONTRACT_WEEKDAYS WHERE CONTRACT_ID=V_CONTRACT_ID AND WEEKDAY=V_TEMP_DAY;

   DBMS_OUTPUT.PUT_LINE(V_TEMP_COUNT);

   if V_TEMP_COUNT > 0 then
   BEGIN

   BEGIN
   SELECT EMPLOYEE_ID into V_TEMP_EMP_ID  FROM HRIS_CUST_CONTRACT_EMP WHERE CONTRACT_ID=V_CONTRACT_ID AND V_FROM_DATE+i BETWEEN START_DATE AND END_DATE; 

    EXCEPTION
      WHEN NO_DATA_FOUND THEN
        V_TEMP_EMP_ID := NULL;
        END;

   DBMS_OUTPUT.PUT_LINE(V_TEMP_EMP_ID);

   INSERT INTO HRIS_CUST_CONTRACT_ATTENDANCE (CONTRACT_ID,ATTENDANCE_DT,EMPLOYEE_ID) VALUES (V_CONTRACT_ID,V_FROM_DATE+i,V_TEMP_EMP_ID);

   END;
    end if;

  END LOOP;
END;

END;
end if;



if V_WORKING_CYCLE = 'R' then
BEGIN

BEGIN
    FOR V_R_DATES IN (SELECT * FROM HRIS_CUST_CONTRACT_DATES WHERE CONTRACT_ID=V_CONTRACT_ID) LOOP
    
        DBMS_OUTPUT.PUT_LINE(V_R_DATES.CONTRACT_ID);
        DBMS_OUTPUT.PUT_LINE(V_R_DATES.MANUAL_DATE);
    
    BEGIN
   SELECT EMPLOYEE_ID into V_TEMP_EMP_ID  FROM HRIS_CUST_CONTRACT_EMP WHERE CONTRACT_ID=V_CONTRACT_ID AND V_R_DATES.MANUAL_DATE BETWEEN START_DATE AND END_DATE; 
    EXCEPTION
      WHEN NO_DATA_FOUND THEN
        V_TEMP_EMP_ID := NULL;
        END;
    
    INSERT INTO HRIS_CUST_CONTRACT_ATTENDANCE (CONTRACT_ID,ATTENDANCE_DT,EMPLOYEE_ID)VALUES(V_R_DATES.CONTRACT_ID,V_R_DATES.MANUAL_DATE,V_TEMP_EMP_ID);
    
    END LOOP;
END;

--
END;
end if;




END;