CREATE OR REPLACE PROCEDURE HRIS_POST_CHECK_ATTENDANCE(
    P_ATTENDANCE_DT DATE ,
    P_EMPLOYEE_ID   NUMBER:=NULL)
AS
  V_LATE_STATUS HRIS_ATTENDANCE_DETAIL.LATE_STATUS%TYPE;
BEGIN
  FOR attendance IN
  (SELECT         *
  FROM HRIS_ATTENDANCE_DETAIL
  WHERE ATTENDANCE_DT= P_ATTENDANCE_DT
  AND (EMPLOYEE_ID   =
    CASE
      WHEN P_EMPLOYEE_ID IS NOT NULL
      THEN P_EMPLOYEE_ID
    END
  OR P_EMPLOYEE_ID IS NULL)
  )
  LOOP
    IF attendance.OUT_TIME     IS NULL THEN
      IF attendance.LATE_STATUS ='L' THEN
        V_LATE_STATUS          := 'Y';
      ELSE
        V_LATE_STATUS := 'X';
      END IF;
      UPDATE HRIS_ATTENDANCE_DETAIL
      SET LATE_STATUS   = V_LATE_STATUS
      WHERE EMPLOYEE_ID = attendance.EMPLOYEE_ID
      AND ATTENDANCE_DT = attendance.ATTENDANCE_DT;
    END IF;
  END LOOP;
END;