DECLARE
  V_COT_ID NUMBER:=44;
BEGIN
  FOR attendance IN
  (SELECT AD.*
  FROM HRIS_ATTENDANCE_DETAIL AD ,
    (SELECT COT.EARLY_OVERTIME_HR,
      COT.LATE_OVERTIME_HR,
      COT.START_DATE,
      COT.END_DATE,
      ECOT.EMPLOYEE_ID
    FROM HRIS_COMPULSORY_OVERTIME COT
    JOIN HRIS_EMPLOYEE_COMPULSORY_OT ECOT
    ON (COT.COMPULSORY_OVERTIME_ID  = ECOT.COMPULSORY_OVERTIME_ID)
    WHERE COT.COMPULSORY_OVERTIME_ID=V_COT_ID
    ) OT
  WHERE AD.EMPLOYEE_ID=OT.EMPLOYEE_ID
  AND (AD.ATTENDANCE_DT BETWEEN OT.START_DATE AND OT.END_DATE )
  )
  LOOP
    NULL;
  END LOOP;
END;
/
--
SELECT EMPLOYEE_ID,
  ATTENDANCE_DT,
  IN_TIME,
  OUT_TIME,
  START_TIME,
  END_TIME,
  EXTRACT(HOUR FROM EARLY_OT_HR)*60+EXTRACT(MINUTE FROM EARLY_OT_HR) AS ACT_EARLY_OT_HR,
  EXTRACT(HOUR FROM LATE_OT_HR) *60+EXTRACT(MINUTE FROM LATE_OT_HR)  AS ACT_LATE_OT_HR,
  EARLY_OVERTIME_HR,
  LATE_OVERTIME_HR
FROM
  (SELECT AD.EMPLOYEE_ID,
    AD.ATTENDANCE_DT,
    AD.IN_TIME,
    AD.OUT_TIME,
    S.START_TIME,
    S.END_TIME,
    ((S.START_TIME-TRUNC(S.START_TIME))-(AD.IN_TIME -TRUNC(AD.IN_TIME))) AS EARLY_OT_HR,
    ((AD.OUT_TIME -TRUNC(AD.OUT_TIME))-(S.END_TIME-TRUNC(S.END_TIME)))   AS LATE_OT_HR,
    OT.EARLY_OVERTIME_HR,
    OT.LATE_OVERTIME_HR
  FROM HRIS_ATTENDANCE_DETAIL AD ,
    (SELECT COT.EARLY_OVERTIME_HR,
      COT.LATE_OVERTIME_HR,
      COT.START_DATE,
      COT.END_DATE,
      ECOT.EMPLOYEE_ID
    FROM HRIS_COMPULSORY_OVERTIME COT
    JOIN HRIS_EMPLOYEE_COMPULSORY_OT ECOT
    ON (COT.COMPULSORY_OVERTIME_ID  = ECOT.COMPULSORY_OVERTIME_ID)
    WHERE COT.COMPULSORY_OVERTIME_ID=45
    ) OT,
    HRIS_SHIFTS S
  WHERE AD.EMPLOYEE_ID=OT.EMPLOYEE_ID
  AND (AD.ATTENDANCE_DT BETWEEN OT.START_DATE AND OT.END_DATE )
  AND AD.OVERALL_STATUS  IN ('PR','LA','BA')
  AND AD.LATE_STATUS NOT IN ('X','Y')
  AND AD.SHIFT_ID         =S.SHIFT_ID
  );
--
SELECT EMPLOYEE_ID,
  SUM(ACT_EARLY_OT_HR),
  SUM(ACT_LATE_OT_HR),
  SUM(EARLY_OVERTIME_HR),
  SUM(LATE_OVERTIME_HR)
FROM
  (SELECT EMPLOYEE_ID,
    ATTENDANCE_DT,
    IN_TIME,
    OUT_TIME,
    START_TIME,
    END_TIME,
    EXTRACT(HOUR FROM EARLY_OT_HR)*60+EXTRACT(MINUTE FROM EARLY_OT_HR) AS ACT_EARLY_OT_HR,
    EXTRACT(HOUR FROM LATE_OT_HR) *60+EXTRACT(MINUTE FROM LATE_OT_HR)  AS ACT_LATE_OT_HR,
    EARLY_OVERTIME_HR,
    LATE_OVERTIME_HR
  FROM
    (SELECT AD.EMPLOYEE_ID,
      AD.ATTENDANCE_DT,
      AD.IN_TIME,
      AD.OUT_TIME,
      S.START_TIME,
      S.END_TIME,
      ((S.START_TIME-TRUNC(S.START_TIME))-(AD.IN_TIME -TRUNC(AD.IN_TIME))) AS EARLY_OT_HR,
      ((AD.OUT_TIME -TRUNC(AD.OUT_TIME))-(S.END_TIME-TRUNC(S.END_TIME)))   AS LATE_OT_HR,
      OT.EARLY_OVERTIME_HR,
      OT.LATE_OVERTIME_HR
    FROM HRIS_ATTENDANCE_DETAIL AD ,
      (SELECT COT.EARLY_OVERTIME_HR,
        COT.LATE_OVERTIME_HR,
        COT.START_DATE,
        COT.END_DATE,
        ECOT.EMPLOYEE_ID
      FROM HRIS_COMPULSORY_OVERTIME COT
      JOIN HRIS_EMPLOYEE_COMPULSORY_OT ECOT
      ON (COT.COMPULSORY_OVERTIME_ID  = ECOT.COMPULSORY_OVERTIME_ID)
      WHERE COT.COMPULSORY_OVERTIME_ID=44
      ) OT,
      HRIS_SHIFTS S
    WHERE AD.EMPLOYEE_ID=OT.EMPLOYEE_ID
    AND (AD.ATTENDANCE_DT BETWEEN OT.START_DATE AND OT.END_DATE )
    AND AD.OVERALL_STATUS  IN ('PR','LA','BA')
    AND AD.LATE_STATUS NOT IN ('X','Y')
    AND AD.SHIFT_ID         =S.SHIFT_ID
    )
  )
GROUP BY EMPLOYEE_ID;

SELECT * FROM HRIS_COMPULSORY_OVERTIME;
SELECT *
FROM HRIS_OVERTIME
WHERE OVERTIME_DATE BETWEEN TO_DATE('17-NOV-17','DD-MON-RR') AND TO_DATE('15-DEC-17','DD-MON-RR') AND EMPLOYEE_ID IN (SELECT EMPLOYEE_ID FROM HRIS_EMPLOYEE_COMPULSORY_OT WHERE COMPULSORY_OVERTIME_ID = 44);