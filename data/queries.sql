BEGIN
  FOR mv IN
  (SELECT *
  FROM
    (SELECT EMPLOYEE_ID,
      FISCAL_YEAR_ID,
      MONTH_ID,
      ROW_NUMBER() OVER (PARTITION BY EMPLOYEE_ID ORDER BY EMPLOYEE_ID,FISCAL_YEAR_ID ) R
    FROM HRIS_FLAT_VALUE_DETAIL
    )
  WHERE R!=1
  )
  LOOP
  
  DELETE FROM HRIS_FLAT_VALUE_DETAIL WHERE EMPLOYEE_ID = mv.EMPLOYEE_ID AND FISCAL_YEAR_ID = mv.FISCAL_YEAR_ID AND MONTH_ID = mv.MONTH_ID;
  
  END LOOP;
END;


BEGIN
  FOR u IN
  (SELECT U.*
  FROM HRIS_USERS U
  JOIN HRIS_EMPLOYEES E
  ON (U.EMPLOYEE_ID  = E.EMPLOYEE_ID)
  WHERE U.USER_NAME IN
    (SELECT USER_NAME FROM HRIS_USERS GROUP BY USER_NAME HAVING COUNT(*) > 1
    )
  AND E.STATUS= 'D'
  ORDER BY USER_NAME
  )
  LOOP
    DELETE FROM HRIS_USERS WHERE USER_ID= u.USER_ID;
  END LOOP;
END;
--
SELECT USER_NAME FROM HRIS_USERS GROUP BY USER_NAME HAVING COUNT(*) > 1;


SELECT * FROM HRIS_USERS ORDER BY CREATED_DT DESC;

UPDATE HRIS_USERS SET ROLE_ID = 3 WHERE CREATED_DT = '14-AUG-17';