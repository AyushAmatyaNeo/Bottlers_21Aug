<?php
$this->headScript()
        ->appendFile($this->basePath('js/SelfService/travel-request/expense-request.js'))
        ->appendFile($this->basePath('js/angular.min.js'))
        ->appendFile($this->basePath('js/SelfService/travel-request/expenseDtlController.js'));

$form->setAttribute('role', 'form');
$form->setAttribute('id', 'travelRequest-form');

$fromDate = $form->get('fromDate');
$fromDate->setAttributes(["disabled"=>"disabled"]);
$toDate = $form->get('toDate');
$toDate->setAttributes(["disabled"=>"disabled"]);
$travelCode = $form->get('travelCode');
$travelCode->setAttributes(["disabled"=>"disabled"]);
$destination = $form->get('destination');
$destination->setAttributes(["disabled"=>"disabled"]);
$purpose = $form->get('purpose');
$purpose->setAttributes(["disabled"=>"disabled"]);
$requestedType = $form->get('requestedType');
$requestedType->setValueOptions($requestTypes);
$requestedType->setValueOptions(["ep"=>"Expense"]);
$requestedType->setAttributes(["disabled"=>"disabled"]);
$requestedAmount = $form->get('requestedAmount');
$requestedAmount->setValue("");
$requestedAmount->setAttributes(["required"=>"required"]);
$remarks = $form->get('remarks');
$remarks->setValue("");
$submit = $form->get('submit');
$submit->setAttribute('value','SUBMIT');

$form->setAttribute('action', $this->url('travelRequest', ['action' => 'expenseRequest','id'=>$id]));

if ($this->messages) {
    print '<ul class="help-block bg-danger" style="background:#f3e250;">';
    foreach ($this->messages as $message) {
        print '<li>' . $message . '</li>';
    }
    print '</ul>';
}

?>
    <script>
        document.menu=<?php $menu = ["id" => "menuSelfService","subMenu"=>["id"=>"subMenuTravelRequest"]];echo json_encode($menu);?>;
        document.url = '<?= $this->url("restful", ["action" => "index"]) ?>';
    </script>
<div class="page-bar">
    <?= $this->navigation('Zend\Navigation\travelRequest')->breadcrumbs()->setMinDepth(0)->setPartial('partial/breadcrumb') ?>
</div>
    <div class="row margin-top-20" ng-app="hris" ng-controller="expenseDtlController">
    <div class="col-sm-12">
        <div class="portlet box custom-box">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-user"></i>Travel Request Detail
                </div>
            </div>
            <div class="portlet-body div-font-11">
                <form name="travelExpenseForm" id="travelRequest-form" ng-submit="submitExpenseDtl()" novalidate>
                    <input type="text" id="travelId" value="<?php echo $id; ?>" />
                <div class="row">
                    <div class="col-xs-12 col-sm-4 col-md-4 col-box bottomgap">
                        <table>
                            <tr>
                                <td width="40%"><label for="travelCode">Travel Code :</label></td>
                                <td><input type="text" disabled="disabled" value="<?php echo $detail['TRAVEL_CODE']; ?>" name="travelCode" required="required" id="travelCode" class="form-control"></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="col-xs-12 col-sm-4 col-md-4 col-box bottomgap">
                        <table>
                            <tr>
                                <td width="40%">
                                   <label for="advanceAmount">Advance Amount :</label> 
                                </td>
                                <td>
                                    <input type="text" disabled="disabled" value="<?php echo $detail['REQUESTED_AMOUNT']; ?>" name="advanceAmount" required="required" id="advanceAmount" class="form-control">
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-xs-12 col-sm-4 col-md-4 col-box bottomgap">
                        <table>
                            <tr>
                                <td width="40%">
                                   <label for="destination">Destination :</label> 
                                </td>
                                <td>
                                    <input type="text" disabled="disabled" value="<?php echo $detail['DESTINATION'] ?>" name="destination" required="required" id="destination" class="form-control">
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12 col-sm-4 col-md-4 col-box bottomgap">
                        <table>
                            <tr>
                                <td width="40%">
                                   <label for="purpose">Purpose :</label> 
                                </td>
                                <td>
                                    <input type="text" disabled="disabled" value="<?php echo $detail['PURPOSE']; ?>" name="purpose" required="required" id="purpose" class="form-control">
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-xs-12 col-sm-4 col-md-4 col-box bottomgap">
                        <table>
                            <tr>
                                <td width="40%">
                                    <label for="departureDate">Departure Date :</label>
                                </td>
                                <td>
                                    <input type="text" required="required" name="departureDate" required="required" id="departureDate" class="form-control">
                                    <div ng-show="travelExpenseForm.$submitted || travelExpenseForm.departureDate.$touched">
                                        <ul ng-show="travelExpenseForm.departureDate.$error.required" class="help-block error">
                                            <li>Departure Date is required.</li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="col-xs-12 col-sm-4 col-md-4 col-box bottomgap">
                        <table>
                            <tr>
                                <td width="40%">
                                   <label for="employeeCode">Returned Date :</label> 
                                </td>
                                <td>
                                   <input type="text" required="required" name="returnedDate" required="required" id="returnedDate" class="form-control"> 
                                    <div ng-show="travelExpenseForm.$submitted || travelExpenseForm.returnedDate.$touched">
                                        <ul ng-show="travelExpenseForm.returnedDate.$error.required" class="help-block error">
                                            <li>Returned Date is required.</li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="margin-top-10 scrollbar-horizantal">
                <table width="100%" align="center" class="table table-striped table-bordered table-hover no-footer customTable div-font-11">
                    <thead style="font-size:11px !important;">
                        <tr>
                            <th colspan="6" align="center">Description of Travel and Place</th>
                            <th rowspan="3">Mode of Travel</th>
                            <th rowspan="3">Fare</th>
                            <th rowspan="3">Daily Allowance</th>
                            <th rowspan="3">Local Conveyence</th>
                            <th rowspan="3">Misc. Expenses</th>
                            <th rowspan="3">Total</th>
                            <th rowspan="3">Remarks</th>
                            <th rowspan="3"></th>
                        </tr>
                        <tr>
                            <th colspan="3">Departure</th>
                            <th colspan="3">Destination</th>
                        </tr>
                        <tr>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Place</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Place</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="expenseDtlForm in expenseDtlFormList">
                            <td>
                                <input type="text" required="required" name="departureDate_{{expenseDtlForm.checkbox}}" ng-model="expenseDtlForm.departureDate" size="11"/>
                                <div ng-show="travelExpenseForm.$submitted || travelExpenseForm.departureDate_{{expenseDtlForm.checkbox}}.$touched">
                                    <ul ng-show="travelExpenseForm.departureDate_{{expenseDtlForm.checkbox}}.$error.required" class="help-block error">
                                        <li>Departure Date is required.</li>
                                    </ul>
                                </div>
                            </td>
                            <td>
                                <input type="text" required="required" name="departureTime_{{expenseDtlForm.checkbox}}" ng-model="expenseDtlForm.departureTime" size="11"/>
                                <div ng-show="travelExpenseForm.$submitted || travelExpenseForm.departureTime_{{expenseDtlForm.checkbox}}.$touched">
                                    <ul ng-show="travelExpenseForm.departureTime_{{expenseDtlForm.checkbox}}.$error.required" class="help-block error">
                                        <li>Departure Time is required.</li>
                                    </ul>
                                </div>
                            </td>
                            <td>
                                <input type="text" required="required" name="departurePlace_{{expenseDtlForm.checkbox}}" ng-model="expenseDtlForm.departurePlace" size="11"/>
                                <div ng-show="travelExpenseForm.$submitted || travelExpenseForm.departurePlace_{{expenseDtlForm.checkbox}}.$touched">
                                    <ul ng-show="travelExpenseForm.departurePlace_{{expenseDtlForm.checkbox}}.$error.required" class="help-block error">
                                        <li>Departure Place is required.</li>
                                    </ul>
                                </div>
                            </td>
                            <td>
                                <input type="text" required="required" name="destinationDate_{{expenseDtlForm.checkbox}}" ng-model="expenseDtlForm.destinationDate" size="11"/>
                                <div ng-show="travelExpenseForm.$submitted || travelExpenseForm.destinationDate_{{expenseDtlForm.checkbox}}.$touched">
                                    <ul ng-show="travelExpenseForm.destinationDate_{{expenseDtlForm.checkbox}}.$error.required" class="help-block error">
                                        <li>Destination Date is required.</li>
                                    </ul>
                                </div>
                            </td>
                            <td>
                                <input type="text" required="required" name="destinationTime_{{expenseDtlForm.checkbox}}" ng-model="expenseDtlForm.destinationTime" size="11"/>
                                <div ng-show="travelExpenseForm.$submitted || travelExpenseForm.destinationTime_{{expenseDtlForm.checkbox}}.$touched">
                                    <ul ng-show="travelExpenseForm.destinationTime_{{expenseDtlForm.checkbox}}.$error.required" class="help-block error">
                                        <li>Destination Time is required.</li>
                                    </ul>
                                </div>
                            </td>
                            <td>
                                <input type="text" required="required" name="destinationPlace_{{expenseDtlForm.checkbox}}" ng-model="expenseDtlForm.destinationPlace" size="11"/>
                                <div ng-show="travelExpenseForm.$submitted || travelExpenseForm.destinationPlace_{{expenseDtlForm.checkbox}}.$touched">
                                    <ul ng-show="travelExpenseForm.destinationPlace_{{expenseDtlForm.checkbox}}.$error.required" class="help-block error">
                                        <li>Destination Place is required.</li>
                                    </ul>
                                </div>
                            </td>
                            <td>
                                <select style="width: 110px;" name="transportType" ng-model="expenseDtlForm.transportType" ng-options="transportTypes.name for transportTypes in transportTypeList track by transportTypes.id" required="required" id="transportType" class="form-control">
                                </select>
                            </td>
                            <td>
                                <input type="number" required="required" name="fare_{{expenseDtlForm.checkbox}}" ng-model="expenseDtlForm.fare" style="width: 60px;" step="0.01" min="0"/>
                                <div ng-show="travelExpenseForm.$submitted || travelExpenseForm.fare_{{expenseDtlForm.checkbox}}.$touched">
                                    <ul ng-show="travelExpenseForm.fare_{{expenseDtlForm.checkbox}}.$error.required" class="help-block error">
                                        <li>Fare is required.</li>
                                    </ul>
                                </div>
                            </td>
                            <td>
                                <input type="number" ng-model="expenseDtlForm.allowance" style="width: 60px;" step="0.01" min="0"/>
                            </td>
                            <td>
                                <input type="number" ng-model="expenseDtlForm.localConveyence"style="width: 69px;" step="0.01" min="0"/>
                            </td>
                            <td>
                                <input type="number" ng-model="expenseDtlForm.miscExpense" style="width: 60px;" step="0.01" min="0"/>
                            </td>
                            <td>
                                <input type="number" ng-model="expenseDtlForm.total" style="width: 60px;" step="0.01" min="0"/>
                            </td>
                            <td>
                                <input type="text" ng-model="expenseDtlForm.remarks" size="11"/>
                            </td>
                            <td width="1%"  class="checkboxgap">
                                <div class="md-checkbox">
                                    <input type="checkbox" id="{{expenseDtlForm.checkbox}}" class="md-check"
                                           ng-model="expenseDtlForm.checked">
                                    <label for="{{expenseDtlForm.checkbox}}">
                                        <span class="inc"></span>
                                        <span class="check"></span>
                                        <span class="box"></span>
                                    </label>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>
                                <a href="javascript:;" class="btn btn-icon-only default pull-right"
                                   ng-click="addExpenseDtl()">
                                    <i class="fa fa-plus"></i>
                                </a>
                            </td>
                            <td>
                                <a href="javascript:;" class="btn btn-icon-only default" ng-click="deleteExpenseDtl()">
                                    <i class="fa fa-trash-o"></i>
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>
                </div>
                <div class="submit_button" style="margin-top:2%;">
                    <input type="submit" name="submit" class="btn btn-success" value="SUBMIT">               
                </div>
               </form>
            </div>
        </div>
    </div>
</div>

   